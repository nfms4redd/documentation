
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.7.5">
    
    
      
        <title>Publicación de datos en GeoServer - Documentación de administración de NFMS4REDD</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-769c285a91.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Documentación de administración de NFMS4REDD" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Publicación de datos en GeoServer
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Documentación de administración de NFMS4REDD
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../inventory/" title="Inventario" class="md-nav__link">
      Inventario
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Instalación del servidor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Instalación del servidor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install/docker/" title="Instalación con Docker" class="md-nav__link">
      Instalación con Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/packages/" title="Instalación con paquetes" class="md-nav__link">
      Instalación con paquetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/backups/" title="Copias de seguridad" class="md-nav__link">
      Copias de seguridad
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/performance/" title="Rendimiento" class="md-nav__link">
      Rendimiento
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../postgis/" title="Carga de datos en PostGIS" class="md-nav__link">
      Carga de datos en PostGIS
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Publicación de datos en GeoServer
      </label>
    
    <a href="./" title="Publicación de datos en GeoServer" class="md-nav__link md-nav__link--active">
      Publicación de datos en GeoServer
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#resolviendo-el-problema-de-las-etiquetas" title="Resolviendo el problema de las etiquetas" class="md-nav__link">
    Resolviendo el problema de las etiquetas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descripcion-del-problema" title="Descripción del problema" class="md-nav__link">
    Descripción del problema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solucion-1-metatileado" title="Solución 1: Metatileado" class="md-nav__link">
    Solución 1: Metatileado
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacion-del-metatileado-en-geoserver" title="Implementación del metatileado en GeoServer" class="md-nav__link">
    Implementación del metatileado en GeoServer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solucion-2-creacion-de-una-capa-de-puntos" title="Solución 2: Creación de una capa de puntos" class="md-nav__link">
    Solución 2: Creación de una capa de puntos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencias" title="Referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Configuración del portal
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Configuración del portal
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config/portal/" title="Configuración del portal" class="md-nav__link">
      Configuración del portal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/temporal/" title="Configuración de capas temporales" class="md-nav__link">
      Configuración de capas temporales
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/raster_temporal/" title="Configuración de capas raster temporales" class="md-nav__link">
      Configuración de capas raster temporales
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../optimization/" title="Optimizaciones" class="md-nav__link">
      Optimizaciones
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#resolviendo-el-problema-de-las-etiquetas" title="Resolviendo el problema de las etiquetas" class="md-nav__link">
    Resolviendo el problema de las etiquetas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descripcion-del-problema" title="Descripción del problema" class="md-nav__link">
    Descripción del problema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solucion-1-metatileado" title="Solución 1: Metatileado" class="md-nav__link">
    Solución 1: Metatileado
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacion-del-metatileado-en-geoserver" title="Implementación del metatileado en GeoServer" class="md-nav__link">
    Implementación del metatileado en GeoServer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solucion-2-creacion-de-una-capa-de-puntos" title="Solución 2: Creación de una capa de puntos" class="md-nav__link">
    Solución 2: Creación de una capa de puntos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencias" title="Referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="publicacion-de-datos-en-geoserver">Publicación de datos en GeoServer</h1>
<p>Existe en la red cantidad de información sobre el proceso de publicación de datos en GeoServer. Enlazamos desde aquí a la información de GeoTalleres donde encontrará documentación amplia información sobre este servidor de mapas.</p>
<ul>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-install/geoserver_install.html">Instalación de GeoServer (con PostGIS)</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-intro/geoserver_intro.html">Introducción a GeoServer</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-vector/geoserver_vector.html">GeoServer: Publicación de datos vectoriales</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-raster/geoserver_raster.html">GeoServer: Publicación de datos raster</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-piramide-raster-transparencia/geoserver_piramide_raster_transparencia.html">GeoServer: Creación de una pirámide raster con transparencia</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-produccion/geoserver_produccion.html">GeoServer en producción</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geoserver-backup/geoserver_backup.html">Copias de seguridad de GeoServer</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/geowebcache/pregeneracion.html">Pregeneración de teselas en GeoWebCache</a></li>
<li><a href="https://geotalleres.readthedocs.io/es/latest/optimizacion-raster-gdal/optimizacion-raster-gdal.html">Optimización de GeoTIFF para su publicación</a></li>
</ul>
<p>A continuación se exponen algunas soluciones para problemas particulares encontrados en el proceso de publicación de datos de algunos paises.</p>
<h2 id="resolviendo-el-problema-de-las-etiquetas">Resolviendo el problema de las etiquetas</h2>
<h3 id="descripcion-del-problema">Descripción del problema</h3>
<p>Tenemos una capa de provincias, de la que disponemos de las geometrías del polígono y de un campo con el nombre de la provincia. Se quiere publicar en un servidor de mapas, de manera que se muestre el polígono de la provincia y en un punto interior el nombre de la misma. </p>
<p>Para ello, mediante el uso de GeoServer, publicamos la capa y le aplicamos el siguiente estilo::</p>
<div class="codehilite"><pre><span></span>    <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="nt">&lt;StyledLayerDescriptor</span> <span class="na">version=</span><span class="s">&quot;1.0.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/sld&quot;</span> <span class="na">xmlns:ogc=</span><span class="s">&quot;http://www.opengis.net/ogc&quot;</span>
  <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!--  simbologia_adm_prov_4326 --&gt;</span>
  <span class="c">&lt;!-- http://geo2.ambiente.gob.ar/geoserver/bosques_umsef_db/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=bosques_umsef_db:limites_provinciales&amp;styles=&amp;bbox=-73.566302817,-52.394802778,-53.637962552,-21.777951173&amp;width=333&amp;height=512&amp;srs=EPSG:4326&amp;format=application/openlayers&amp;TIME=1999 --&gt;</span>

  <span class="nt">&lt;NamedLayer&gt;</span>
    <span class="nt">&lt;Name&gt;</span>Blue lake<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;UserStyle&gt;</span>
      <span class="nt">&lt;Title&gt;</span>Blue lake<span class="nt">&lt;/Title&gt;</span>
      <span class="nt">&lt;Abstract&gt;</span>A blue fill, solid black outline style<span class="nt">&lt;/Abstract&gt;</span>
      <span class="nt">&lt;FeatureTypeStyle&gt;</span>
    <span class="nt">&lt;Rule&gt;</span>
      <span class="nt">&lt;Name&gt;</span>name<span class="nt">&lt;/Name&gt;</span>
      <span class="nt">&lt;PolygonSymbolizer&gt;</span>
        <span class="nt">&lt;Fill&gt;</span>
          <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ogc:Literal&gt;</span>#ffffff<span class="nt">&lt;/ogc:Literal&gt;</span>
          <span class="nt">&lt;/CssParameter&gt;</span>
          <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ogc:Literal&gt;</span>1.0<span class="nt">&lt;/ogc:Literal&gt;</span>
          <span class="nt">&lt;/CssParameter&gt;</span>
        <span class="nt">&lt;/Fill&gt;</span>
      <span class="nt">&lt;/PolygonSymbolizer&gt;</span>
           <span class="nt">&lt;LineSymbolizer&gt;</span>
        <span class="nt">&lt;Stroke&gt;</span>
          <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;stroke&quot;</span><span class="nt">&gt;</span>#000000<span class="nt">&lt;/CssParameter&gt;</span>
            <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;stroke-width&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/CssParameter&gt;</span>
        <span class="nt">&lt;/Stroke&gt;</span>
           <span class="nt">&lt;/LineSymbolizer&gt;</span>
      <span class="nt">&lt;TextSymbolizer&gt;</span>
       <span class="nt">&lt;Geometry&gt;</span>
     <span class="nt">&lt;ogc:Function</span> <span class="na">name=</span><span class="s">&quot;interiorPoint&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;ogc:PropertyName&gt;</span>the_geom<span class="nt">&lt;/ogc:PropertyName&gt;</span>
     <span class="nt">&lt;/ogc:Function&gt;</span>
       <span class="nt">&lt;/Geometry&gt;</span>
           <span class="nt">&lt;Label&gt;</span>
              <span class="nt">&lt;ogc:PropertyName&gt;</span>NAME_1<span class="nt">&lt;/ogc:PropertyName&gt;</span>
            <span class="nt">&lt;/Label&gt;</span>
            <span class="nt">&lt;LabelPlacement&gt;</span>
              <span class="nt">&lt;PointPlacement&gt;</span>
                <span class="nt">&lt;AnchorPoint&gt;</span>
                  <span class="nt">&lt;AnchorPointX&gt;</span>0.5<span class="nt">&lt;/AnchorPointX&gt;</span>
                  <span class="nt">&lt;AnchorPointY&gt;</span>0.5<span class="nt">&lt;/AnchorPointY&gt;</span>
                <span class="nt">&lt;/AnchorPoint&gt;</span>
              <span class="nt">&lt;/PointPlacement&gt;</span>
            <span class="nt">&lt;/LabelPlacement&gt;</span>
            <span class="nt">&lt;Halo&gt;</span>
              <span class="nt">&lt;Radius&gt;</span>
                <span class="nt">&lt;ogc:Literal&gt;</span>2<span class="nt">&lt;/ogc:Literal&gt;</span>
              <span class="nt">&lt;/Radius&gt;</span>
              <span class="nt">&lt;Fill&gt;</span>
                <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>#FFFFFF<span class="nt">&lt;/CssParameter&gt;</span>
              <span class="nt">&lt;/Fill&gt;</span>
            <span class="nt">&lt;/Halo&gt;</span>
            <span class="nt">&lt;Fill&gt;</span>
              <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>#000000<span class="nt">&lt;/CssParameter&gt;</span>
            <span class="nt">&lt;/Fill&gt;</span>
            <span class="nt">&lt;VendorOption</span> <span class="na">name=</span><span class="s">&quot;goodnessOfFit&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/VendorOption&gt;</span>
            <span class="nt">&lt;VendorOption</span> <span class="na">name=</span><span class="s">&quot;conflictResolution&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/VendorOption&gt;</span>
          <span class="nt">&lt;/TextSymbolizer&gt;</span>
              <span class="nt">&lt;/Rule&gt;</span>
      <span class="nt">&lt;/FeatureTypeStyle&gt;</span>
    <span class="nt">&lt;/UserStyle&gt;</span>
      <span class="nt">&lt;/NamedLayer&gt;</span>
    <span class="nt">&lt;/StyledLayerDescriptor&gt;</span>
</pre></div>


<p>De esta manera, publicada la capa, podremos observar a través de la previsualización de capas, que el aspecto de la capa es el siguiente:</p>
<p><img alt="" src="../images/metatiles/sin_tiled.png" />
   http://demo.geomati.co/geoserver/unredd-test/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=unredd-test:provincias_inicial&amp;styles=&amp;bbox=-73.5777809999999,-55.06152999999995,-53.59183499999989,-21.778547999999944&amp;width=461&amp;height=768&amp;srs=EPSG:4326&amp;format=application/openlayers</p>
<p>En este momento la capa se está sirviendo como una sola imagen. Esto lo podremos comprobar en la pestaña de <code>Red</code> de las herramientas de desarrollo de nuestro navegador (Google Chrome en este caso):</p>
<p>.. image:: _static/metatiles/unique_petition.png</p>
<p>Para conseguir una mejor experiencia de usuario, se usa las peticiones teseladas, que consiste en particionar la imagen total en varias de menor tamaño, tiles (teselas), y de esta manera la descarga de la imagen se realiza en multiples imagenes que unidas componen la imagen total. En nuestro caso, para definir el uso de las teselas, podremos, desde el previsualizador de capas, en los parámetros adicionales:</p>
<p>.<img alt="" src="../images/metatiles/aditional_parameters.png" /></p>
<p>Desde la barra de parámetros opcionales, podremos definir que nos devuelva la imagen teselada, para ello en la opción <strong>Tilling</strong>, seleccionamos <strong>Tiled</strong>. Podremos comprobar en la pestaña de <code>Red</code> de nuestras herramientas de desarrollo que ahora en vez de realizar una única petición, realiza varias, una por cada tesela, para componer la imagen total:</p>
<p><img alt="" src="../images/metatiles/tiled.png" /></p>
<p>La diferencia es que en este último caso, cada petición realizada por el cliente, se trata de una parte de la imagen global:</p>
<p><img alt="" src="../images/metatiles/single_tile.png" /></p>
<p>El problema que aparece es que en algunas provincias, desaparecen las etiquetas con los nombres. Según variemos el zoom, podremos observar que estas etiquetas van apareciendo y desapareciendo de manera aleatoria.</p>
<p><img alt="" src="../images/metatiles/missing.png" /></p>
<p>Esto es debido al proceso de creación de las teselas. Lo que sucede es que en el momento de definir la tesela, el servidor comprueba que la etiqueta esté completamente incluida en la tesela, y en caso contrario, delega la creación de la etiqueta en otra tesela, pero, si como en este caso, la etiqueta no vuelve a encajar dentro de otra tesela, esta etiqueta no será dibujada. Como se observa en la siguente figura, para la provincia por encima de Rio Negro y debajo de Mendoza, que aparece sin etiqueta, se puede ver como el límite de la tesela, coincide justo con la posición donde estaría la etiqueta.</p>
<p><img alt="" src="../images/metatiles/tile_not_label.png" /></p>
<h3 id="solucion-1-metatileado">Solución 1: Metatileado</h3>
<p>Las metatiles son tiles creadas de la combinación de varias tiles. Su beneficio es que el servidor de mapas genera el contenido de las tiles a partir de una metatile creada anteriormente y que después se partirá en el número de tiles necesario.</p>
<p><img alt="" src="../images/metatiles/metatile.png" /></p>
<p>En la imagen anterior podemos observar una metatile 3x3, que está compuesta por 9 tiles. 
Además de la composición en N tiles, las metatiles disponen de una parte que es el buffer, que será tenida en cuenta a la hora de generar la metatile, pero que no se mostrará en las teselas resultantes de la metatile. </p>
<p><img alt="" src="../images/metatiles/metatile_gutter.png" /></p>
<p>El objetivo de este buffer es permitir que las etiquetas, marcadores, etc, que se encuentran en los límites de la metatile, se dibujen correctamente ya que estos elementos serán tenidos en cuenta en la generación de las teselas de esa metatile.</p>
<h4 id="implementacion-del-metatileado-en-geoserver">Implementación del metatileado en GeoServer</h4>
<p>GeoWebCache, integrado en GeoServer es el que aporta la solución del metatileado a este servidor de mapas. Para aplicar este:</p>
<p>vamos a la pestaña <code>Tile Caching</code> de nuestra capa publicada en GeoServer</p>
<p><img alt="" src="../images/metatiles/tile_caching_layer.png" /></p>
<p>en las opciones de <code>Tile cache configuration</code> selecciones los siguientes valores:</p>
<ul>
<li>Seleccionamos <code>Create a cached layer for this layer</code></li>
<li>Seleccionamos <code>Enable tile caching for this layer</code></li>
<li>En <code>Metatiling Factors</code> seleccionamos valores 4 <code>tiles wide</code> por 4 <code>tiles high</code></li>
<li>Seleccionamos un tamaño de Gutter (buffer) de 100 pixels</li>
</ul>
<p><img alt="" src="../images/metatiles/tile_cache_configuration.png" /></p>
<p>De esta manera, se generará una metatile de 4x4, con un buffer de 100px.</p>
<p>Ahora podremos consumir desde nuestro cliente la capa que se está <code>sirviendo a través de GeoWebCache</code>_, bien usando la URL asociada a esta capa:</p>
<blockquote>
<p>http://example.com/geoserver/gwc/service/wms</p>
</blockquote>
<p>o mediante el uso de las peticiones GetMap del WMS siempre que GeoServer se encuentre correctamente configurado. </p>
<blockquote>
<p>Revisar documentación del uso de GeoWebCache dentro de GeoServer que se adjunta en la referencia de este capítulo</p>
</blockquote>
<h3 id="solucion-2-creacion-de-una-capa-de-puntos">Solución 2: Creación de una capa de puntos</h3>
<p>Otra solución al problema de las etiquetas de las capas es la separación de los elementos en varias capas y su posterior consumo. Para ello lo que se realizó es lo siguiente. </p>
<p>A partir de la capa de polígonos se obtiene una capa con los puntos interiores mediante el uso, por ejemplo, de un SIG de Escritorio como QGIS o mediante el uso de cualquier otra herramienta SIG como PostGIS, OGR, etc. El producto final del procesamiento será una capa de puntos.</p>
<p><img alt="" src="../images/metatiles/centroides.png" />
http://demo.geomati.co/geoserver/unredd-test/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=unredd-test:centroides_sin_estilo&amp;styles=&amp;bbox=-70.11797893048644,-54.33202129909892,-54.64727704784167,-23.317464204714994&amp;width=383&amp;height=768&amp;srs=EPSG:4326&amp;format=application/openlayers</p>
<p>Ahora deberemos dividir el SLD con el estilo original en dos partes y aplicaremos estos estilos a cada una de las capas. Por un lado mostraremos los contornos de las provincias sobre la capa de provincias original:</p>
<div class="codehilite"><pre><span></span>    <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="nt">&lt;StyledLayerDescriptor</span> <span class="na">version=</span><span class="s">&quot;1.0.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/sld&quot;</span> <span class="na">xmlns:ogc=</span><span class="s">&quot;http://www.opengis.net/ogc&quot;</span>
      <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd&quot;</span><span class="nt">&gt;</span>

      <span class="nt">&lt;NamedLayer&gt;</span>
    <span class="nt">&lt;Name&gt;</span>Blue lake<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;UserStyle&gt;</span>
      <span class="nt">&lt;Title&gt;</span>Blue lake<span class="nt">&lt;/Title&gt;</span>
      <span class="nt">&lt;Abstract&gt;</span>A blue fill, solid black outline style<span class="nt">&lt;/Abstract&gt;</span>
      <span class="nt">&lt;FeatureTypeStyle&gt;</span>
        <span class="nt">&lt;Rule&gt;</span>
          <span class="nt">&lt;Name&gt;</span>name<span class="nt">&lt;/Name&gt;</span>
          <span class="nt">&lt;PolygonSymbolizer&gt;</span>
            <span class="nt">&lt;Fill&gt;</span>
              <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ogc:Literal&gt;</span>#ffffff<span class="nt">&lt;/ogc:Literal&gt;</span>
              <span class="nt">&lt;/CssParameter&gt;</span>
              <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ogc:Literal&gt;</span>1.0<span class="nt">&lt;/ogc:Literal&gt;</span>
              <span class="nt">&lt;/CssParameter&gt;</span>
            <span class="nt">&lt;/Fill&gt;</span>
          <span class="nt">&lt;/PolygonSymbolizer&gt;</span>
          <span class="nt">&lt;LineSymbolizer&gt;</span>
            <span class="nt">&lt;Stroke&gt;</span>
                <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;stroke&quot;</span><span class="nt">&gt;</span>#000000<span class="nt">&lt;/CssParameter&gt;</span>
                <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;stroke-width&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/CssParameter&gt;</span>
            <span class="nt">&lt;/Stroke&gt;</span>
          <span class="nt">&lt;/LineSymbolizer&gt;</span>
        <span class="nt">&lt;/Rule&gt;</span>
      <span class="nt">&lt;/FeatureTypeStyle&gt;</span>
    <span class="nt">&lt;/UserStyle&gt;</span>
      <span class="nt">&lt;/NamedLayer&gt;</span>
    <span class="nt">&lt;/StyledLayerDescriptor&gt;</span>
</pre></div>


<p>lo que dará como resultado:</p>
<p><img alt="" src="../images/metatiles/provincias_only.png" />
http://demo.geomati.co/geoserver/unredd-test/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=unredd-test:provincias&amp;styles=&amp;bbox=-73.5777809999999,-55.06152999999995,-53.59183499999989,-21.778547999999944&amp;width=461&amp;height=768&amp;srs=EPSG:4326&amp;format=application/openlayers</p>
<p>y por otro lado usaremos el estilo de las etiquetas con la capa de puntos que acabamos de generar:</p>
<div class="codehilite"><pre><span></span>    <span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="nt">&lt;StyledLayerDescriptor</span> <span class="na">version=</span><span class="s">&quot;1.0.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/sld&quot;</span> <span class="na">xmlns:ogc=</span><span class="s">&quot;http://www.opengis.net/ogc&quot;</span>
      <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd&quot;</span><span class="nt">&gt;</span>

      <span class="nt">&lt;NamedLayer&gt;</span>
    <span class="nt">&lt;Name&gt;</span>Blue lake<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;UserStyle&gt;</span>
      <span class="nt">&lt;Title&gt;</span>Blue lake<span class="nt">&lt;/Title&gt;</span>
      <span class="nt">&lt;Abstract&gt;</span>A blue fill, solid black outline style<span class="nt">&lt;/Abstract&gt;</span>
      <span class="nt">&lt;FeatureTypeStyle&gt;</span>
        <span class="nt">&lt;Rule&gt;</span>
          <span class="nt">&lt;Name&gt;</span>name<span class="nt">&lt;/Name&gt;</span>
          <span class="nt">&lt;TextSymbolizer&gt;</span>
           <span class="nt">&lt;Label&gt;</span>
              <span class="nt">&lt;ogc:PropertyName&gt;</span>NAME_1<span class="nt">&lt;/ogc:PropertyName&gt;</span>
            <span class="nt">&lt;/Label&gt;</span>
            <span class="nt">&lt;LabelPlacement&gt;</span>
              <span class="nt">&lt;PointPlacement&gt;</span>
                <span class="nt">&lt;AnchorPoint&gt;</span>
                  <span class="nt">&lt;AnchorPointX&gt;</span>0.5<span class="nt">&lt;/AnchorPointX&gt;</span>
                  <span class="nt">&lt;AnchorPointY&gt;</span>0.5<span class="nt">&lt;/AnchorPointY&gt;</span>
                <span class="nt">&lt;/AnchorPoint&gt;</span>
              <span class="nt">&lt;/PointPlacement&gt;</span>
            <span class="nt">&lt;/LabelPlacement&gt;</span>
            <span class="nt">&lt;Halo&gt;</span>
              <span class="nt">&lt;Radius&gt;</span>
                <span class="nt">&lt;ogc:Literal&gt;</span>2<span class="nt">&lt;/ogc:Literal&gt;</span>
              <span class="nt">&lt;/Radius&gt;</span>
              <span class="nt">&lt;Fill&gt;</span>
                <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>#FFFFFF<span class="nt">&lt;/CssParameter&gt;</span>
              <span class="nt">&lt;/Fill&gt;</span>
            <span class="nt">&lt;/Halo&gt;</span>
            <span class="nt">&lt;Fill&gt;</span>
              <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>#000000<span class="nt">&lt;/CssParameter&gt;</span>
            <span class="nt">&lt;/Fill&gt;</span>
            <span class="nt">&lt;VendorOption</span> <span class="na">name=</span><span class="s">&quot;goodnessOfFit&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/VendorOption&gt;</span>
            <span class="nt">&lt;VendorOption</span> <span class="na">name=</span><span class="s">&quot;conflictResolution&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/VendorOption&gt;</span>
          <span class="nt">&lt;/TextSymbolizer&gt;</span>
              <span class="nt">&lt;/Rule&gt;</span>
      <span class="nt">&lt;/FeatureTypeStyle&gt;</span>
    <span class="nt">&lt;/UserStyle&gt;</span>
      <span class="nt">&lt;/NamedLayer&gt;</span>
    <span class="nt">&lt;/StyledLayerDescriptor&gt;</span>
</pre></div>


<p>lo que mostrará la capa de la siguiente manera:</p>
<p><img alt="" src="../images/metatiles/labels.png" />
http://demo.geomati.co/geoserver/unredd-test/wms?service=WMS&amp;version=1.1.0&amp;request=GetMap&amp;layers=unredd-test:centroides&amp;styles=&amp;bbox=-70.11797893048644,-54.33202129909892,-54.64727704784167,-23.317464204714994&amp;width=383&amp;height=768&amp;srs=EPSG:4326&amp;format=application/openlayers</p>
<p>Ahora deberemos pinchar ambas capas por separado en nuestro visor, aplicando el teselado en la de provincias y mostrando sin teselar la de las etiquetas.</p>
<h3 id="referencias">Referencias</h3>
<p><code>Metatiles</code><em> <a href="http://geowebcache.org/docs/current/concepts/metatiles.html">EN</a>
<code>Understanding Metatiles</code></em> <a href="https://www.mapbox.com/tilemill/docs/guides/metatiles/">EN</a>
<code>MapProxy WMS Labeling</code><em>  <a href="http://mapproxy.org/docs/nightly/labeling.html">EN</a>
<code>Using GeoWebCache</code></em>  <a href="http://docs.geoserver.org/stable/en/user/geowebcache/using.html">EN</a></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../postgis/" title="Carga de datos en PostGIS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Carga de datos en PostGIS
              </span>
            </div>
          </a>
        
        
          <a href="../config/portal/" title="Configuración del portal" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configuración del portal
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-07b0fbb49b.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>